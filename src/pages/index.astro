---
import Dust from "components/Dust/Dust.astro";
import Layout from "layouts/Layout.astro";
import SocialMedia from "components/SocialMedia.astro";
import PreviewArticle from "components/PreviewArticle/PreviewArticle.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog"))
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .filter(({ data }) => data.publishDate.valueOf() <= new Date().valueOf())
  .slice(0, 2);
---

<Layout title="Piotr Sochacz - Software Engineer">
  <main>
    <section class="intro relative flex h-[80dvh] w-full justify-center">
      <img
        class="absolute top-0 left-0 z-10 h-[80dvh] w-full object-cover object-[80%] md:object-right"
        src="/intro.webp"
        alt="Background image presenting cave"
      />
      <div
        class="absolute bottom-8 left-6 z-30 container mx-auto md:left-auto landscape:bottom-8 landscape:lg:bottom-1/3"
      >
        <h1>
          <span class="text-5xl text-slate-100">Piotr Sochacz</span>
          <br />
          <span class="font-serif text-2xl text-slate-300">
            Software Developer
          </span>
        </h1>
        <SocialMedia />
      </div>
      <Dust class="absolute top-0 left-0 z-20" />
    </section>
    <section>
      <div class="bg-white py-24 sm:py-32">
        <div class="mx-auto max-w-7xl px-6 lg:px-8">
          <div
            class="mx-auto flex max-w-2xl flex-col items-center justify-center lg:mx-0"
          >
            <h2
              class="scroll-m-20 border-b pb-2 font-sans text-4xl font-semibold text-pretty first:mt-0 sm:text-5xl"
            >
              Blog
            </h2>
          </div>
          <div
            class="mx-auto mt-10 grid max-w-2xl grid-cols-1 gap-x-8 gap-y-16 border-t border-gray-200 pt-10 sm:mt-16 sm:pt-16 lg:mx-0 lg:max-w-none lg:grid-cols-3"
          >
            {
              posts.map(({ data, slug }) => (
                <PreviewArticle
                  authorId={data.author}
                  slug={slug}
                  title={data.title}
                  description={data.description}
                  categories={data.categories}
                  year={data.publishDate.getFullYear().toString()}
                  month={data.publishDate.toLocaleDateString("en-US", {
                    month: "2-digit",
                  })}
                  publishDate={data.publishDate.toLocaleDateString("en-US", {
                    month: "short",
                    day: "numeric",
                    year: "numeric",
                  })}
                />
              ))
            }
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  .intro:after {
    pointer-events: none;
    animation: grain 8s steps(10) infinite;
    content: "";
    background-image: url(/noise.png);
    height: 300%;
    left: -50%;
    opacity: 0.015;
    position: fixed;
    z-index: 10;
    top: -100%;
    width: 300%;
  }

  @keyframes grain {
    0%,
    100% {
      transform: translate(0, 0);
    }
    10% {
      transform: translate(-5%, -10%);
    }
    20% {
      transform: translate(-15%, 5%);
    }
    30% {
      transform: translate(7%, -25%);
    }
    40% {
      transform: translate(-5%, 25%);
    }
    50% {
      transform: translate(-15%, 10%);
    }
    60% {
      transform: translate(15%, 0%);
    }
    70% {
      transform: translate(0%, 15%);
    }
    80% {
      transform: translate(3%, 30%);
    }
    90% {
      transform: translate(-10%, 10%);
    }
  }
</style>
