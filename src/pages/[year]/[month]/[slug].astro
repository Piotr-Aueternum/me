---
import Layout from "layouts/Layout.astro";
import { getCollection } from "astro:content";
import { render } from "astro:content";
import TableOfContents from "components/TableOfContents.astro";
import MarkdocStyled from "components/MarkdocStyled.astro";
import Datetime from "components/Datetime.astro";

export async function getStaticPaths() {
  return await getCollection("blog")
    .then((posts) =>
      posts.map((post) => ({
        params: {
          year: post.data.publishDate.getFullYear().toString(),
          month: (post.data.publishDate.getMonth() + 1)
            .toString()
            .padStart(2, "0"),
          slug: post.id,
        },
        props: post,
      }))
    )
    .then((paths) =>
      paths.sort((a, b) => a.params.year.localeCompare(b.params.year))
    );
}

const post = Astro.props;

const { Content } = await render(post);
---

<Layout title={Astro.props.data.title}>
  <div class="mx-auto px-4 py-8 sm:w-lg lg:w-2xl">
    <header><a href="/" class="text-2xl underline">Home</a></header>
    <main>
      <article class="mx-auto py-4">
        <header class="my-2">
          <h1 class="pt-6 pb-2 text-justify text-5xl font-bold text-pretty">
            {Astro.props.data.title}
          </h1>
          <div class="my-3">
            <p class="text-muted-foreground mb-2 text-right text-sm">
              <Datetime date={Astro.props.data.publishDate}>
                <Fragment slot="before">Published:</Fragment>
              </Datetime>
            </p>
            {
              Astro.props.data.updatedDate && (
                <Datetime date={Astro.props.data.updatedDate}>
                  <Fragment slot="before">Updated:</Fragment>
                </Datetime>
              )
            }
          </div>
          <img src={post.data.hero} loading="lazy" alt="" class="rounded-xl" />
        </header>
        <TableOfContents />
        <section class="text-justify text-pretty">
          <MarkdocStyled>
            <Content />
          </MarkdocStyled>
        </section>
      </article>
    </main>
  </div>
</Layout>
